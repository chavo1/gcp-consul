{
  "version": 4,
  "terraform_version": "0.12.10",
  "serial": 7,
  "lineage": "45323280-2d3b-c9d9-4f73-333c78c24d10",
  "outputs": {
    "private_ip": {
      "value": [
        "172.31.32.11",
        "172.31.32.12"
      ],
      "type": [
        "tuple",
        [
          "string",
          "string"
        ]
      ]
    },
    "public_ip": {
      "value": [
        "35.186.160.177",
        "35.245.220.147"
      ],
      "type": [
        "tuple",
        [
          "string",
          "string"
        ]
      ]
    }
  },
  "resources": [
    {
      "module": "module.gcp_consul_servers",
      "mode": "managed",
      "type": "google_compute_instance",
      "name": "server",
      "each": "list",
      "provider": "provider.google",
      "instances": [
        {
          "index_key": 0,
          "schema_version": 6,
          "attributes": {
            "allow_stopping_for_update": true,
            "attached_disk": [],
            "boot_disk": [
              {
                "auto_delete": true,
                "device_name": "persistent-disk-0",
                "disk_encryption_key_raw": "",
                "disk_encryption_key_sha256": "",
                "initialize_params": [
                  {
                    "image": "https://www.googleapis.com/compute/v1/projects/sup-eng-eu/global/images/packer-1563530504",
                    "labels": {},
                    "size": 10,
                    "type": "pd-standard"
                  }
                ],
                "kms_key_self_link": "",
                "mode": "READ_WRITE",
                "source": "https://www.googleapis.com/compute/v1/projects/sup-eng-eu/zones/us-east4-a/disks/consul-server00"
              }
            ],
            "can_ip_forward": false,
            "cpu_platform": "Intel Broadwell",
            "deletion_protection": false,
            "description": "",
            "disk": [],
            "guest_accelerator": [],
            "hostname": "",
            "id": "consul-server00",
            "instance_id": "8903001293051889274",
            "label_fingerprint": "42WmSpB8rSM=",
            "labels": null,
            "machine_type": "f1-micro",
            "metadata": {
              "ssh-keys": "kayode:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDUqsBdVtZfJQdvL/8D4d/oUnhqg0sGhMd3pt4Fpop+GHIF3JPWr9jYb1y9j13Gx6eQTlEpycTe3JxUjuTGYDahdX9VRrUFMabwqMfXGfyfmx3jvkUoX2lbVgDWNEND5+YHUHT98kiWZPUmcUeHz4SIUHriKQ0Lgnb7APQZhM0Owyknzlkp4XeVfRZuN0yjIjinv1P646im9dTYYhwCZXsjCG0wLE0jZ5nRyP//gOhrFPLouSZc6oITwrb4thHIbf1JwJBtJN5AgnBYprtA+cXnlw1NiErkE/MqXe605VafGlQQ4az5VY7yzNxJsnt3tLyv4+D/k4xoyasA9sfzzEKmKPxlxblFWGGgt258nz0pJuco12OPQ1FgNitLIlt44bD2/sseCeIRro4Y+Smv6RzobqlfPaFcmNroxXVopDuwrMc36G6vxBenFkIGitoLtZm5oEDx6N0aRS08wQOr6MC5yqbX61THJu0cg1Ws7EHL0QZf4HK5ntkvCNJiq1xK7OlmgPKNQcD46OAVwj/ZKE/WGsF+SiW9nk+6+5oDZ5lKs+cDVuXRAFQtpB84GUe/dPNXBFTeHryWvyfWsmShSkW4Fg1FEfCbbKSeXd0nDGq/qxxFdKZNrkQEl9mMxWh3glwpkz6JErBAw9h0ef62UrqCwRs0w92qDgvzLikR2F3Ihw== chavdar.rakov@gmail.com\n"
            },
            "metadata_fingerprint": "0IoiHLuni3Y=",
            "metadata_startup_script": "#!/usr/bin/env bash\n\nexport DEBIAN_FRONTEND=noninteractive\n\nexport IPs=$(hostname -I)\nexport HOST=$(hostname)\nexport DC=\"gcp-virginia\"\n\nsudo killall consul\nsudo mkdir -p /etc/consul.d/ /opt/consul/\n\n# ###########################\n# # Starting consul servers #\n# ###########################\nif [[ $IPs =~ 172.31.16 ]]; then # if 172.31.16 it is dc1\n    DC_RANGE_OP=\"172.31.32\"\n    DC_RANGE=\"172.31.16\"\nelif [[ $IPs =~ 172.31.32 ]]; then  # if 172.31.32 it is dc2\n    DC_RANGE_OP=\"172.31.16\"\n    DC_RANGE=\"172.31.32\"\nelse # if 172.31.48 it is dc3\n    DC_RANGE_OP=\"172.31.16\"\n    DC_RANGE=\"172.31.48\"\nfi   \n\nNODE_TYPE=client\nWAN=\"\"\n# Cloud Auto-joining \n# LAN=\", \\\"retry_join\\\": [ \\\"provider=aws tag_key=consul tag_value=app\\\" ]\"\n# Joining with private IPs\nLAN=\", \\\"retry_join\\\": [ \\\"$DC_RANGE.11\\\", \\\"$DC_RANGE.12\\\", \\\"$DC_RANGE.13\\\" ]\"\n# WAN=\", \\\"retry_join_wan\\\": [ \\\"$DC_RANGE_OP.11\\\", \\\"$DC_RANGE_OP.12\\\", \\\"$DC_RANGE_OP.13\\\" ]\"\n\n# if the name contain ip-172-31-*-1 we are on server\nif [[ $HOST =~ ip-172-31-16-1 || $HOST =~ ip-172-31-32-1 || $IPs =~ 172.31.48.1 ]]; then\n  NODE_TYPE=server\n  # WAN=\", \\\"retry_join_wan\\\": [ \\\"provider=aws tag_key=consul_wan tag_value=wan_app\\\" ]\"\n  # Joining with private IPs\n  WAN=\", \\\"retry_join_wan\\\": [ \\\"$DC_RANGE_OP.11\\\", \\\"$DC_RANGE_OP.12\\\", \\\"$DC_RANGE_OP.13\\\" ]\"\nfi\n\nsudo cat \u003c\u003cEOF \u003e /etc/consul.d/config.json\n{ \n  \"datacenter\": \"${DC}\",\n  \"ui\": true,\n  \"client_addr\": \"0.0.0.0\",\n  \"bind_addr\": \"0.0.0.0\",\n  \"advertise_addr\": \"${IPs}\",\n  \"enable_script_checks\": true,\n  \"data_dir\": \"/opt/consul\"${LAN}${WAN}\n}\nEOF\n\nsudo chown -R consul:consul /etc/consul.d/\nsudo chmod -R 775 /etc/consul.d/\n\n###################\n# Starting Consul #\n###################\nsudo systemctl daemon-reload\nsudo systemctl start consul\n\n###########################\n# Redirecting conslul log #\n###########################\n    if [ -d /opt/consul ]; then\n        mkdir -p /opt/consul/consul_logs\n        journalctl -f -u consul.service \u0026\u003e /opt/consul/consul_logs/${HOST}.log \u0026\n    else\n        journalctl -f -u consul.service \u003e /tmp/consul.log\n    fi\necho consul started\nset +x\nsleep 10\nconsul members\n",
            "min_cpu_platform": "",
            "name": "consul-server00",
            "network_interface": [
              {
                "access_config": [
                  {
                    "assigned_nat_ip": "",
                    "nat_ip": "35.186.160.177",
                    "network_tier": "PREMIUM",
                    "public_ptr_domain_name": ""
                  }
                ],
                "address": "",
                "alias_ip_range": [],
                "name": "nic0",
                "network": "https://www.googleapis.com/compute/v1/projects/sup-eng-eu/global/networks/vpc-chavo",
                "network_ip": "172.31.32.11",
                "subnetwork": "https://www.googleapis.com/compute/v1/projects/sup-eng-eu/regions/us-east4/subnetworks/subnet-vm",
                "subnetwork_project": "sup-eng-eu"
              }
            ],
            "project": "sup-eng-eu",
            "scheduling": [
              {
                "automatic_restart": true,
                "node_affinities": [],
                "on_host_maintenance": "MIGRATE",
                "preemptible": false
              }
            ],
            "scratch_disk": [],
            "self_link": "https://www.googleapis.com/compute/v1/projects/sup-eng-eu/zones/us-east4-a/instances/consul-server00",
            "service_account": [
              {
                "email": "187559344020-compute@developer.gserviceaccount.com",
                "scopes": [
                  "https://www.googleapis.com/auth/compute.readonly"
                ]
              }
            ],
            "shielded_instance_config": [],
            "tags": [
              "consul"
            ],
            "tags_fingerprint": "MmxraX72Rqk=",
            "timeouts": null,
            "zone": "us-east4-a"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiNiJ9"
        },
        {
          "index_key": 1,
          "schema_version": 6,
          "attributes": {
            "allow_stopping_for_update": true,
            "attached_disk": [],
            "boot_disk": [
              {
                "auto_delete": true,
                "device_name": "persistent-disk-0",
                "disk_encryption_key_raw": "",
                "disk_encryption_key_sha256": "",
                "initialize_params": [
                  {
                    "image": "https://www.googleapis.com/compute/v1/projects/sup-eng-eu/global/images/packer-1563530504",
                    "labels": {},
                    "size": 10,
                    "type": "pd-standard"
                  }
                ],
                "kms_key_self_link": "",
                "mode": "READ_WRITE",
                "source": "https://www.googleapis.com/compute/v1/projects/sup-eng-eu/zones/us-east4-a/disks/consul-server01"
              }
            ],
            "can_ip_forward": false,
            "cpu_platform": "Intel Broadwell",
            "deletion_protection": false,
            "description": "",
            "disk": [],
            "guest_accelerator": [],
            "hostname": "",
            "id": "consul-server01",
            "instance_id": "8120528598990030457",
            "label_fingerprint": "42WmSpB8rSM=",
            "labels": null,
            "machine_type": "f1-micro",
            "metadata": {
              "ssh-keys": "kayode:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDUqsBdVtZfJQdvL/8D4d/oUnhqg0sGhMd3pt4Fpop+GHIF3JPWr9jYb1y9j13Gx6eQTlEpycTe3JxUjuTGYDahdX9VRrUFMabwqMfXGfyfmx3jvkUoX2lbVgDWNEND5+YHUHT98kiWZPUmcUeHz4SIUHriKQ0Lgnb7APQZhM0Owyknzlkp4XeVfRZuN0yjIjinv1P646im9dTYYhwCZXsjCG0wLE0jZ5nRyP//gOhrFPLouSZc6oITwrb4thHIbf1JwJBtJN5AgnBYprtA+cXnlw1NiErkE/MqXe605VafGlQQ4az5VY7yzNxJsnt3tLyv4+D/k4xoyasA9sfzzEKmKPxlxblFWGGgt258nz0pJuco12OPQ1FgNitLIlt44bD2/sseCeIRro4Y+Smv6RzobqlfPaFcmNroxXVopDuwrMc36G6vxBenFkIGitoLtZm5oEDx6N0aRS08wQOr6MC5yqbX61THJu0cg1Ws7EHL0QZf4HK5ntkvCNJiq1xK7OlmgPKNQcD46OAVwj/ZKE/WGsF+SiW9nk+6+5oDZ5lKs+cDVuXRAFQtpB84GUe/dPNXBFTeHryWvyfWsmShSkW4Fg1FEfCbbKSeXd0nDGq/qxxFdKZNrkQEl9mMxWh3glwpkz6JErBAw9h0ef62UrqCwRs0w92qDgvzLikR2F3Ihw== chavdar.rakov@gmail.com\n"
            },
            "metadata_fingerprint": "0IoiHLuni3Y=",
            "metadata_startup_script": "#!/usr/bin/env bash\n\nexport DEBIAN_FRONTEND=noninteractive\n\nexport IPs=$(hostname -I)\nexport HOST=$(hostname)\nexport DC=\"gcp-virginia\"\n\nsudo killall consul\nsudo mkdir -p /etc/consul.d/ /opt/consul/\n\n# ###########################\n# # Starting consul servers #\n# ###########################\nif [[ $IPs =~ 172.31.16 ]]; then # if 172.31.16 it is dc1\n    DC_RANGE_OP=\"172.31.32\"\n    DC_RANGE=\"172.31.16\"\nelif [[ $IPs =~ 172.31.32 ]]; then  # if 172.31.32 it is dc2\n    DC_RANGE_OP=\"172.31.16\"\n    DC_RANGE=\"172.31.32\"\nelse # if 172.31.48 it is dc3\n    DC_RANGE_OP=\"172.31.16\"\n    DC_RANGE=\"172.31.48\"\nfi   \n\nNODE_TYPE=client\nWAN=\"\"\n# Cloud Auto-joining \n# LAN=\", \\\"retry_join\\\": [ \\\"provider=aws tag_key=consul tag_value=app\\\" ]\"\n# Joining with private IPs\nLAN=\", \\\"retry_join\\\": [ \\\"$DC_RANGE.11\\\", \\\"$DC_RANGE.12\\\", \\\"$DC_RANGE.13\\\" ]\"\n# WAN=\", \\\"retry_join_wan\\\": [ \\\"$DC_RANGE_OP.11\\\", \\\"$DC_RANGE_OP.12\\\", \\\"$DC_RANGE_OP.13\\\" ]\"\n\n# if the name contain ip-172-31-*-1 we are on server\nif [[ $HOST =~ ip-172-31-16-1 || $HOST =~ ip-172-31-32-1 || $IPs =~ 172.31.48.1 ]]; then\n  NODE_TYPE=server\n  # WAN=\", \\\"retry_join_wan\\\": [ \\\"provider=aws tag_key=consul_wan tag_value=wan_app\\\" ]\"\n  # Joining with private IPs\n  WAN=\", \\\"retry_join_wan\\\": [ \\\"$DC_RANGE_OP.11\\\", \\\"$DC_RANGE_OP.12\\\", \\\"$DC_RANGE_OP.13\\\" ]\"\nfi\n\nsudo cat \u003c\u003cEOF \u003e /etc/consul.d/config.json\n{ \n  \"datacenter\": \"${DC}\",\n  \"ui\": true,\n  \"client_addr\": \"0.0.0.0\",\n  \"bind_addr\": \"0.0.0.0\",\n  \"advertise_addr\": \"${IPs}\",\n  \"enable_script_checks\": true,\n  \"data_dir\": \"/opt/consul\"${LAN}${WAN}\n}\nEOF\n\nsudo chown -R consul:consul /etc/consul.d/\nsudo chmod -R 775 /etc/consul.d/\n\n###################\n# Starting Consul #\n###################\nsudo systemctl daemon-reload\nsudo systemctl start consul\n\n###########################\n# Redirecting conslul log #\n###########################\n    if [ -d /opt/consul ]; then\n        mkdir -p /opt/consul/consul_logs\n        journalctl -f -u consul.service \u0026\u003e /opt/consul/consul_logs/${HOST}.log \u0026\n    else\n        journalctl -f -u consul.service \u003e /tmp/consul.log\n    fi\necho consul started\nset +x\nsleep 10\nconsul members\n",
            "min_cpu_platform": "",
            "name": "consul-server01",
            "network_interface": [
              {
                "access_config": [
                  {
                    "assigned_nat_ip": "",
                    "nat_ip": "35.245.220.147",
                    "network_tier": "PREMIUM",
                    "public_ptr_domain_name": ""
                  }
                ],
                "address": "",
                "alias_ip_range": [],
                "name": "nic0",
                "network": "https://www.googleapis.com/compute/v1/projects/sup-eng-eu/global/networks/vpc-chavo",
                "network_ip": "172.31.32.12",
                "subnetwork": "https://www.googleapis.com/compute/v1/projects/sup-eng-eu/regions/us-east4/subnetworks/subnet-vm",
                "subnetwork_project": "sup-eng-eu"
              }
            ],
            "project": "sup-eng-eu",
            "scheduling": [
              {
                "automatic_restart": true,
                "node_affinities": [],
                "on_host_maintenance": "MIGRATE",
                "preemptible": false
              }
            ],
            "scratch_disk": [],
            "self_link": "https://www.googleapis.com/compute/v1/projects/sup-eng-eu/zones/us-east4-a/instances/consul-server01",
            "service_account": [
              {
                "email": "187559344020-compute@developer.gserviceaccount.com",
                "scopes": [
                  "https://www.googleapis.com/auth/compute.readonly"
                ]
              }
            ],
            "shielded_instance_config": [],
            "tags": [
              "consul"
            ],
            "tags_fingerprint": "MmxraX72Rqk=",
            "timeouts": null,
            "zone": "us-east4-a"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiNiJ9"
        }
      ]
    }
  ]
}
